<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ìƒì¶”&ê¹€ì¹˜ ëª¨ë°”ì¼ í¼ì¦</title>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <style>
        /* ê¸°ë³¸ ì„¤ì • */
        body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            background-color: #222;
            font-family: 'Jua', sans-serif;
            overflow: hidden; /* ìŠ¤í¬ë¡¤ ë°©ì§€ */
            user-select: none; /* í…ìŠ¤íŠ¸ ì„ íƒ ë°©ì§€ */
            -webkit-user-select: none;
            touch-action: manipulation; /* ë”ë¸”íƒ­ í™•ëŒ€ ë°©ì§€ */
        }

        /* 1. ê²Œì„ ì»¨í…Œì´ë„ˆ (ë°˜ì‘í˜•) */
        #game-container {
            position: relative;
            width: 100%;
            height: 100%;
            background-color: #FFC0CB; /* í•‘í¬ ë°°ê²½ */
            border: 5px double black;
            box-sizing: border-box;
            display: flex; /* ê°€ë¡œ ëª¨ë“œì¼ ë•Œë§Œ ë³´ì„ */
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* 2. í¼ì¦ ë³´ë“œ (í™”ë©´ ë†’ì´ì˜ 70% í¬ê¸°ë¡œ ìë™ ì¡°ì ˆ) */
        #puzzle-board {
            width: 70vmin;  /* vmin: í™”ë©´ ê°€ë¡œ/ì„¸ë¡œ ì¤‘ ì‘ì€ ìª½ ê¸°ì¤€ */
            height: 70vmin;
            background-color: #fff;
            border: 3px solid #000;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 2px;
            box-shadow: 5px 5px 10px rgba(0,0,0,0.3);
            z-index: 5;
        }

        .tile {
            width: 100%;
            height: 100%;
            background-size: 400% 400%; /* 4x4 í¼ì¦ì´ë¯€ë¡œ 400% */
            cursor: pointer;
            border-radius: 4px;
        }

        /* ë¹ˆ ì¹¸ ìŠ¤íƒ€ì¼ */
        .empty-tile {
            background: transparent !important;
            box-shadow: inset 0 0 5px rgba(0,0,0,0.1);
        }

        /* 3. ì™¼ìª½ ìƒë‹¨ ì •ë‹µ ë¯¸ë¦¬ë³´ê¸° (ëª¨ë°”ì¼ ë§ì¶¤ í¬ê¸°) */
        #reference-area {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 10;
            background: rgba(255, 255, 255, 0.8);
            padding: 5px;
            border: 2px solid #000;
            border-radius: 10px;
            text-align: center;
        }

        #reference-label {
            display: block;
            font-size: 14px;
            margin-bottom: 2px;
            color: #000;
        }

        #reference-img {
            width: 15vmin; /* í™”ë©´ í¬ê¸°ì— ë¹„ë¡€í•´ì„œ ì¡°ì ˆ */
            height: auto;
            border: 1px solid #000;
            border-radius: 5px;
        }

        /* 4. ì–‘ìª½ ì¥ì‹ ì´ë¯¸ì§€ */
        .deco-img {
            position: absolute;
            bottom: 5vmin;
            height: 30vmin; /* í™”ë©´ ë†’ì´ì˜ 30% */
            z-index: 1;
            filter: drop-shadow(3px 3px 3px rgba(0,0,0,0.2));
        }
        #img-left { left: 5vmin; }
        #img-right { right: 5vmin; }

        /* 5. ë²„íŠ¼ (ëª¨ë°”ì¼ í„°ì¹˜í•˜ê¸° ì¢‹ê²Œ í¬ê²Œ) */
        #btn-restart {
            position: absolute;
            bottom: 3vmin;
            padding: 10px 30px;
            font-size: 20px;
            font-family: 'Jua', sans-serif;
            background-color: #fff;
            border: 3px solid #000;
            border-radius: 30px;
            box-shadow: 4px 4px 0px #000;
            z-index: 10;
        }
        #btn-restart:active { transform: scale(0.95); box-shadow: 2px 2px 0px #000; }

        /* 6. ì˜¤ë²„ë ˆì´ & íŒì—… */
        #overlay {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
            color: white;
            text-align: center;
        }
        
        #overlay-text { font-size: 8vmin; margin-bottom: 20px; text-shadow: 2px 2px 4px #000; }
        
        #success-img {
            width: 50vmin;
            height: 50vmin;
            border: 5px solid #fff;
            border-radius: 15px;
            display: none;
            animation: popUp 0.5s ease-out;
        }

        /* 7. [ì¤‘ìš”] ì„¸ë¡œ ëª¨ë“œ ê²½ê³ ì°½ */
        #portrait-warning {
            display: none; /* ê¸°ë³¸ ìˆ¨ê¹€ */
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            background-color: #333;
            color: #fff;
            z-index: 9999;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-size: 24px;
        }

        /* í™”ë©´ì´ ì„¸ë¡œ(Portrait)ì¼ ë•Œ ê²½ê³ ì°½ í‘œì‹œ */
        @media screen and (orientation: portrait) {
            #game-container { display: none; }
            #portrait-warning { display: flex; }
        }

        @keyframes popUp {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>

    <div id="portrait-warning">
        <img src="kimchi-o2.webp" style="width: 100px; margin-bottom: 20px;">
        <p>ğŸ“± í™”ë©´ì„ ê°€ë¡œë¡œ ëŒë ¤ì£¼ì„¸ìš”!</p>
        <p style="font-size: 16px; color: #bbb;">ìƒì¶”ì™€ ê¹€ì¹˜ê°€ ê¸°ë‹¤ë¦¬ê³  ìˆì–´ìš”</p>
    </div>

    <div id="game-container">
        <div id="reference-area">
            <span id="reference-label">â­ ì •ë‹µ</span>
            <img src="kimchi-b.png" id="reference-img">
        </div>

        <img src="kimchi-o2.webp" id="img-left" class="deco-img">
        <div id="puzzle-board"></div>
        <img src="kimchi-o3.webp" id="img-right" class="deco-img">

        <button id="btn-restart" onclick="initGame()">GAME AGAIN</button>

        <div id="overlay">
            <h1 id="overlay-text">í„°ì¹˜í•˜ë©´ ì‹œì‘!</h1>
            <img src="kimchi-L.png" id="success-img">
        </div>
    </div>

    <script>
        // === ì„¤ì • ë³€ìˆ˜ ===
        const ROWS = 4;
        const COLS = 4;
        const IMG_MAIN = 'kimchi-b.png';
        const IMG_SUCCESS = 'kimchi-L.png';
        
        let tiles = [];
        let emptyIndex = 15;
        let isPlaying = false;

        // === ì‚¬ìš´ë“œ (ëª¨ë°”ì¼ í„°ì¹˜ ëŒ€ì‘) ===
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            const now = audioCtx.currentTime;

            if (type === 'slide') {
                osc.type = 'sine'; osc.frequency.setValueAtTime(600, now);
                gainNode.gain.setValueAtTime(0.1, now); gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                osc.start(now); osc.stop(now + 0.1);
            } else if (type === 'win') {
                osc.type = 'triangle'; 
                osc.frequency.setValueAtTime(523, now); osc.frequency.setValueAtTime(659, now + 0.2); osc.frequency.setValueAtTime(783, now + 0.4);
                gainNode.gain.setValueAtTime(0.3, now); gainNode.gain.linearRampToValueAtTime(0, now + 1.5);
                osc.start(now); osc.stop(now + 1.5);
            } else if (type === 'start') {
                osc.type = 'square'; osc.frequency.setValueAtTime(400, now);
                gainNode.gain.setValueAtTime(0.1, now); gainNode.gain.linearRampToValueAtTime(0, now + 0.2);
                osc.start(now); osc.stop(now + 0.2);
            }
        }

        // === ê²Œì„ ì´ˆê¸°í™” ===
        function initGame() {
            // ì˜¤ë””ì˜¤ ì»¨í…ìŠ¤íŠ¸ í™œì„±í™” (ëª¨ë°”ì¼ í•„ìˆ˜)
            if (audioCtx.state === 'suspended') audioCtx.resume();

            const board = document.getElementById('puzzle-board');
            const overlay = document.getElementById('overlay');
            const successImg = document.getElementById('success-img');
            const overlayText = document.getElementById('overlay-text');

            tiles = [];
            isPlaying = false;
            successImg.style.display = 'none';
            board.innerHTML = '';
            
            // ì •ë‹µ ìƒíƒœ ìƒì„±
            for (let i = 0; i < ROWS * COLS; i++) {
                tiles.push(i);
                createTileElement(i, i, false);
            }

            // ì¹´ìš´íŠ¸ë‹¤ìš´ ì‹œì‘
            overlay.style.display = 'flex';
            playSound('start');
            let count = 3;
            overlayText.innerText = count + "ì´ˆ ë’¤ ì‹œì‘!";

            const countdown = setInterval(() => {
                count--;
                if (count > 0) {
                    overlayText.innerText = count + "ì´ˆ ë’¤ ì‹œì‘!";
                    playSound('start');
                } else {
                    clearInterval(countdown);
                    overlayText.innerText = "Start!";
                    setTimeout(() => {
                        overlay.style.display = 'none';
                        shuffleTiles();
                        isPlaying = true;
                    }, 500);
                }
            }, 1000);
        }

        // === íƒ€ì¼ ìƒì„± (ë°˜ì‘í˜• CSS % ì‚¬ìš©) ===
        function createTileElement(posIndex, imgIndex, showEmpty = true) {
            const board = document.getElementById('puzzle-board');
            const tile = document.createElement('div');
            
            tile.classList.add('tile');
            tile.id = `tile-${posIndex}`;
            
            if (showEmpty && imgIndex === ROWS * COLS - 1) {
                tile.classList.add('empty-tile');
            } else {
                // CSS í¼ì„¼íŠ¸(%) ì¢Œí‘œ ê³„ì‚° (ë°˜ì‘í˜•ì˜ í•µì‹¬!)
                const xPercent = (imgIndex % COLS) * (100 / (COLS - 1));
                const yPercent = Math.floor(imgIndex / ROWS) * (100 / (ROWS - 1));
                
                tile.style.backgroundImage = `url('${IMG_MAIN}')`;
                tile.style.backgroundPosition = `${xPercent}% ${yPercent}%`;
            }
            
            // ëª¨ë°”ì¼ í„°ì¹˜ + PC í´ë¦­ ëª¨ë‘ ëŒ€ì‘
            tile.onclick = () => moveTile(posIndex);
            board.appendChild(tile);
        }

        // === ì…”í”Œ ë¡œì§ (Random Walk) ===
        function shuffleTiles() {
            tiles = Array.from({length: 16}, (_, i) => i);
            emptyIndex = 15;
            let count = 0;
            const maxMoves = 300;
            
            const interval = setInterval(() => {
                const neighbors = getNeighbors(emptyIndex);
                const randomNeighbor = neighbors[Math.floor(Math.random() * neighbors.length)];
                [tiles[emptyIndex], tiles[randomNeighbor]] = [tiles[randomNeighbor], tiles[emptyIndex]];
                emptyIndex = randomNeighbor;
                renderBoard();
                count++;
                if (count >= maxMoves) clearInterval(interval);
            }, 5); // ì†ë„ ì—…
        }

        function getNeighbors(idx) {
            const neighbors = [];
            const row = Math.floor(idx / COLS);
            const col = idx % COLS;
            if (row > 0) neighbors.push(idx - COLS);
            if (row < ROWS - 1) neighbors.push(idx + COLS);
            if (col > 0) neighbors.push(idx - 1);
            if (col < COLS - 1) neighbors.push(idx + 1);
            return neighbors;
        }

        function moveTile(clickIndex) {
            if (!isPlaying) return;
            const neighbors = getNeighbors(emptyIndex);
            if (neighbors.includes(clickIndex)) {
                [tiles[emptyIndex], tiles[clickIndex]] = [tiles[clickIndex], tiles[emptyIndex]];
                emptyIndex = clickIndex;
                playSound('slide');
                renderBoard();
                checkWin();
            }
        }

        function renderBoard() {
            const board = document.getElementById('puzzle-board');
            board.innerHTML = '';
            tiles.forEach((imgNum, posIndex) => {
                createTileElement(posIndex, imgNum, true);
            });
        }

        function checkWin() {
            const isWin = tiles.every((val, index) => val === index);
            if (isWin && isPlaying) {
                isPlaying = false;
                playSound('win');
                setTimeout(() => {
                    const overlay = document.getElementById('overlay');
                    const successImg = document.getElementById('success-img');
                    const overlayText = document.getElementById('overlay-text');
                    
                    // ë¹ˆì¹¸ ì±„ìš°ê¸°
                    const lastTile = document.querySelector('.empty-tile');
                    if(lastTile) {
                        lastTile.classList.remove('empty-tile');
                        lastTile.style.backgroundImage = `url('${IMG_MAIN}')`;
                        lastTile.style.backgroundPosition = `100% 100%`;
                    }

                    overlay.style.display = 'flex';
                    overlayText.innerHTML = "ğŸ‰ ì„±ê³µ! ì°¸ ì˜í–ˆì–´ìš”! ğŸ‰";
                    successImg.src = IMG_SUCCESS;
                    successImg.style.display = 'block';
                }, 300);
            }
        }
        
        // ì´ˆê¸°í™”ë©´: ì‚¬ìš©ìê°€ í„°ì¹˜í•´ì•¼ ì˜¤ë””ì˜¤ê°€ ì¼œì§€ë¯€ë¡œ í´ë¦­ ëŒ€ê¸°
        document.getElementById('overlay').onclick = function() {
            if(!isPlaying && document.getElementById('overlay-text').innerText.includes("í„°ì¹˜")) {
               initGame();
            }
        };

    </script>
</body>
</html>